<!DOCTYPE HTML>
<html>
<head>
  <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="favicon_icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon_icons/favicon-16x16.png">
  <link rel="manifest" href="favicon_icons/site.webmanifest">
  <link rel="shortcut icon" type="image/x-icon" href="favicon_icons/favicon.ico">
  <link href="font/webfontkit-20220210-002804/stylesheet.css" type="text/css" rel="stylesheet">
</head>
<body style="font-family: minecraftregular">

  <p>brooke's pit event website</p>

<script>
for(var i = 0; i < 100; i += 1) { //Make HTML elements
    var div = document.createElement("div");
    console.log("I made an element.")
    div.id = ("event_" + i);
    div.innerHTML = ("test");
    div.style.padding = "10px"; 
    div.style.backgroundColor = "#FFFFFF";
    div.style.textAlign = "center";
    document.body.appendChild(div);
}

function MakeFunTimestamps(convertible) {
let currentTime = (Date.now);
if (convertible - currentTime() <= 60000) {
    convertible = (((Math.floor(((convertible - currentTime())*100))/100000).toFixed(2)) + "s");
} else if (convertible - currentTime() <= 3600000) {
    convertible = ((Math.floor(((convertible - currentTime()))/60000) + "m" + (Math.floor(((convertible - currentTime()))/1000) % 60) + "s"));
} else if (convertible - currentTime() > 1) {
    convertible = ((Math.floor(((convertible - currentTime()))/3600000) + "h" + (Math.floor(((convertible - currentTime()))/60000) % 60) + "m"));
}

return convertible;
}

function test_zero(conversion) { //adds cute colours
for(var i = 0; i < 100; i++) { 
 if(conversion[i]['event'] == "Quick Maths") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#D9D2E9";
 }
 if(conversion[i]['event'] == "Dragon Egg") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#E9D2E1";
 }
 if(conversion[i]['event'] == "2x Rewards") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#D2E9DD";
 }
 if(conversion[i]['event'] == "Care Package") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#E9E2D2";
 }
 if(conversion[i]['event'] == "KOTL") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#D2E9D2";
 }
 if(conversion[i]['event'] == "KOTH") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#D2E9E8";
 }
 if(conversion[i]['event'] == "Auction") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#E9DDD2";
 }
 if(conversion[i]['event'] == "Giant Cake") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#E9D2D2";
 }
 if(conversion[i]['event'] == "All bounty") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#E9E3D2";
 }
 if(conversion[i]['type'] == "major") {
  document.getElementById('event_' + String(i)).style.fontFamily = "minecraftbold";
 }
 if(conversion[i]['event'] == "Squads") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#8EBAEC";
 }
 if(conversion[i]['event'] == "Beast") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#8EEC94";
 }
 if(conversion[i]['event'] == "Pizza") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#ECB38E";
 }
 if(conversion[i]['event'] == "Rage Pit") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#EC8E8E";
 }
 if(conversion[i]['event'] == "Spire") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#EC8EEC";
 }
 if(conversion[i]['event'] == "Robbery") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#ECE98E";
 }
 if(conversion[i]['event'] == "Blockhead") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#9191EC";
 }
 if(conversion[i]['event'] == "Raffle") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#ECBD8E";
 }
 if(conversion[i]['event'] == "Team Deathmatch") {
  document.getElementById('event_' + String(i)).style.backgroundColor = "#BA8EEC";
 }
}
}
const pp_url = 'https://events.mcpqndq.dev/?key=a2cca262-f36c-4b6a-a666-d99a7a8ff440'
data_backup = SaveMyGloriousAPI();
console.log("The data's been called!")
setInterval(getPitPanda,8);

async function SaveMyGloriousAPI() { //Calls the API exactly once (thanks McPqndq for pointing out that i do not have to call apis more than once)
  const response = await fetch(pp_url);
  window.data = await response.json();
  window.data_backup = window.data;
  console.log("API Called.")
}

function UpdateEverything(transformation) { //this plops the stuff in the actual html page
  for(var i = 0; i < 100; i++) { 
  document.getElementById('event_' + String(i)).textContent = (transformation[i].event + " in " + MakeFunTimestamps(transformation[i].timestamp));
  }
  console.log("Just updated " + (i + 1) + " variables.")
}

function getPitPanda() {
  window.data = window.data_backup;
  console.log("Found backup.");
  test_zero(window.data);
  UpdateEverything(window.data);
  console.log("Updated values!");
}

/* Old code

$.getJSON('https://events.mcpqndq.dev/?key=a2cca262-f36c-4b6a-a666-d99a7a8ff440', function(data) {
   PitPandaBackup = data;
   jsonPitPandaEvents = PitPandaBackup;
});

function ConvertAPIToTable() {
  document.body.innerHTML = '';
  jsonPitPandaEvents = PitPandaBackup;
  console.log("BEFORE: ");
  console.log(jsonPitPandaEvents);



  let currentTime = (Date.now);
    for (var i = 0; i < jsonPitPandaEvents.length; ++i) {
      if ((jsonPitPandaEvents[i]['timestamp'] - currentTime) <= 60000) {
        jsonPitPandaEvents[i]['timestamp'] = (((Math.floor((jsonPitPandaEvents[i]['timestamp'] - currentTime)))/1000)+ "s");
          console.log("Converted an object (<1m) at t=" + currentTime);
          console.log(jsonPitPandaEvents[i]['timestamp'])
       }
      else if ((jsonPitPandaEvents[i]['timestamp'] - currentTime) <= 3600000) {
        jsonPitPandaEvents[i]['timestamp'] = (Math.floor(((jsonPitPandaEvents[i]['timestamp'] - currentTime)/60000))+ "m" + (Math.floor(((jsonPitPandaEvents[i]['timestamp'] - currentTime)/1000) % 60)) + "s"); //creates mm:ss format. this is awful code. please do not judge
        console.log("Converted an object (<1h) at t=" + currentTime);
        console.log(jsonPitPandaEvents[i]['timestamp'])
      }
      else {
        jsonPitPandaEvents[i]['timestamp'] = (Math.floor(((jsonPitPandaEvents[i]['timestamp'] - currentTime)/3600000))+ "h" + (Math.floor(((jsonPitPandaEvents[i]['timestamp'] - currentTime)/60000) % 60)) + "m"); //creates hh:mm format. this is awful code. please do not judge
       console.log("Converted an object (<1d) at t=" + currentTime);
       console.log(jsonPitPandaEvents[i]['timestamp'])
     }
    }




  console.log("AFTER: ");
  console.log(jsonPitPandaEvents);
  document.body.appendChild(buildHtmlTable(jsonPitPandaEvents));
}
ConvertAPIToTable();
*/
  </script>

<p>v0.1</p>
</body>

</html>
